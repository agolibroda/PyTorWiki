Права доступа
Права доступа к статьям

Субъекты: Пользователи

Объекты: Статьи; 
	Статьи могут быть «публичными»  «групповыми» и «личными».


Агрегаторы: Группы ( объединяет статьи и пользователей ); 
	Группы могут быть «публичными» и «закрытыми» .

В группы участники принимаются только после запроса. 
В любой группе есть "АДМИН" (хотя бы один) админ "принимает" участников в группу, удаляет их
Присвоить роль "АДМИНА" участнику может только "АДМИН" - похоже, "админ" это роль.
   

Статья имеет особое свойство «разрешения» 
    'pbl' - Публично
    'nop' - Не публично! - Открытый текст, только не публично.
    'grp' – Права определяются группой
    'sol' – Персональная статья, читать и редактировать ее может только автор. 
    
    
Группа описывается данными о пользователях, входящих в группу, и статьями, принадлежащими группе;
Одна статья моет принадлежать нескольким группам. 
в записи о принадлежности статьи есть поле «права» - там значение – или «читать» или «читать/писать» если записи нет, тогда «ой»

алгоритм проверки прав доступа:
1. статья с флагом 'pbl' - то всем пользователям можно читать и редактировать данную статью
2. статья с флагом 'nop' - просто "Не публично" - не закрываем, НО, и не показываем! Это и статьи Автора, и статьи группы.
3. статья с флагом 'sol' - не доступна никому, кроме автора. Кстати, статья ЗАКРЫТА!!! 
4. статья с флагом 'grp' –  статья находится в группе; статья ЗАКРЫТА!!!  


и проверить, есть ли в группах запись о конкретной статье с нужным (по случаю) флагом (читать или писать) … 
ну, и действовать по полученному результату – или, отдать материал в работу, или… 


Персональный рабочий стол

Список всех статей, которые написал Автор 
или, отметил как "интересные" (ОБА-НА!!!!)
в списке НАДО показывать названия групп, в которых набраны статьи....
да и показывать разрешения для статьи  

Список Групп  - названия  - показывать все, и показывать статус группы (публ/закр) 
- в "Рабочий стол группы" закрытой группы - попасть может только участник

есть еще один аспект 
Статью можно:
- комментировать (да/нет)
- редактировать (да/нет)
- оценивать (да/нет) кстати, оценок может быть несколько 
	- и автор может выбрать какими оценками оценивать его статью (или не автор???? )  



"Святая святых" для любой информационной системы  - это база данных 
Что бы снизить моральную нагрузку на АТМИНА :-) я решил, 
что все статьи, имеющие гриф "sol" или "grp" будут в базе храниться "закрытыми" :-) 

механизм: 
при регистрации система для Автора генерирует пару RSA- ключей. :-) 
после генерации ключи рекомендуется скачать на жесткий диск локального компьютера, 
и потом, хранить на флешке в укромном месте.

 
Место хранения ключей в системе:
 
Открытый ключ хранится в поле таблицы "dt_header"

Закрытые ключи:
Все закрытые ключи храним в таблице "grups_keys";
Приватные ключи Авторов храним закрытыми на пароль автора;
Когда Автор создает группу, создается пара групповых ключей, 
приватный ключ закрывается открытым ключом Создателя и кладется в таблицу "grups_keys", открытый  - в таблицу "dt_header";
Когда в группу принимается новый автор Создатель раскрывает ГПК, закрывает его Открытым ключом Автора, 
и кладет в таблицу "grups_keys"
Автор при входе в группу получает свою копию ГПК, раскрывает своим персональным ПК, и далее, 
использует ГПК для чтения/редактирования  закрытых Групповых статей;
 

У группы много участников, и каждых должен иметь возможность 
читать групповые статьи. поэтому, я ввожу новую табличку "grups_keys" в которую для каждого 
Участника каждой группы помещается ЕГО приватный ключ группы, 
закрытый открытым ключом Автора-Участника группы. 
Раз мы уже сделали таблицу, тогда имеет смысл (для единообразия) в этой же таблице хранить и приватный ключ Автора, 
только закрыт ОН будет уже паролем Автора. 

Поскольку пароли имеют свойство забываться, то, восстановление забытого пароля 
(с учетом того, что на пароль закрывается приватный ключ.... становится архиважным делом... )

Для хранения всех приватных ключей используем таблицу "grups_keys";
которая состоит из седующих полей:
  authors_id ID Автора;
  target_id  ID Группы или, Автора (если ключ принадлежит Автору)
  private_key bytea NOT NULL 
  -- приватный ключ - он (если это ключ группы) закодирован на открытый ключ АВТОРА!!! -
  -- или, на пароль пользователя, если ключ принадлежит АВТОРУ.  
 

 



статьи с флагом "sol" перед сохранением в базу кодируется открытым ключом Автора. 
Перед редактированием статья декодируется закрытым ключом Автора, и отдается ему на редактирование.

Для статей с флагом "grp" работают ключи группы. которые генерируется при создании группы.



восстановление пароля. 
 который необходим, если пользователь забыл свой п....



